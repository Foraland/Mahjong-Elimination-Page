System.register("chunks:///_virtual/ComboCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts"],(function(o){var t,i,e;return{setters:[function(o){t=o.createClass},function(o){i=o.cclegacy},function(o){e=o.app}],execute:function(){i._RF.push({},"bd6edeojNdCwZAJaRiaPj2f","ComboCtrl",void 0);var s=o("EComboEvent",{NewCombo:0,EndCombo:1,TickCombo:2});o("ComboCtrl",function(){function o(){this.event=e.gp.obs(),this.combo=0,this.timer=0,this.isInProgress=!1}var i=o.prototype;return i.init=function(){e.manager.timer.get("ComboTimer").schedule(this.onTick.bind(this),.05)},i.onTick=function(){this.timer+=.05,this.isInProgress&&(this.event.emit(s.TickCombo,1-this.timer/this.curComboTime),this.timer>=this.curComboTime&&(this.isInProgress=!1,this.event.emit(s.EndCombo,this.combo),this.combo=0))},i.addCombo=function(){this.combo++,this.combo>=2&&(this.timer=0,this.event.emit(s.NewCombo,this.combo),this.isInProgress=!0)},t(o,[{key:"curComboTime",get:function(){var o=e.config.game.comboTime;return this.combo>=o.length?o[o.length-1]:o[this.combo]}}]),o}());i._RF.pop()}}}));

System.register("chunks:///_virtual/FaceType.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){e({ElimiateId2Type:function(e){if(3!=e.length)return r.None;var n=[].concat(e).sort();return n[0]==n[1]&&n[1]==n[2]&&n[0]>0?r.Peng:n.some((function(e){return i(e)==t.Zi}))?r.None:n[1]-n[0]==1&&n[2]-n[1]==1&&n[0]>0?r.Chi:r.None},FaceId2Type:i,FaceType2Id:function(e){switch(e){case t.Wan:return[1,2,3,4,5,6,7,8,9];case t.Tiao:return[10,11,12,13,14,15,16,17,18];case t.Bing:return[19,20,21,22,23,24,25,26,27];case t.Zi:return[28,29,30,31,32,33,34]}}}),n._RF.push({},"1d772tORORJ9JNd81iDTRAA","FaceType",void 0);var t=e("EFaceType",{Wan:0,Tiao:1,Bing:2,Zi:3});function i(e){return e>0&&e<=9?t.Wan:e>9&&e<=18?t.Tiao:e>18&&e<=27?t.Bing:t.Zi}var r=e("ElimiateType",{None:0,Chi:1,Peng:2});n._RF.pop()}}}));

System.register("chunks:///_virtual/Item.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Config.ts"],(function(t){var e,r,i,n,o,p,s,a,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){o=t.cclegacy,p=t._decorator,s=t.Sprite,a=t.Component},function(t){c=t.app},function(t){u=t.Config}],execute:function(){var l,f,g,m,h;o._RF.push({},"62f99Wp6rBDHJAWH80kq9U6","Item",void 0);var y=p.ccclass,d=p.property;t("Item",(l=y("Item"),f=d(s),l((h=e((m=function(t){function e(){for(var e,r=arguments.length,o=new Array(r),p=0;p<r;p++)o[p]=arguments[p];return e=t.call.apply(t,[this].concat(o))||this,i(e,"sprite",h,n(e)),e.id=0,e}return r(e,t),e.prototype.init=function(t){this.id=t,this.sprite.spriteFrame=c.manager.res.getSprite(u.ItemConfig.get(t).url)},e}(a)).prototype,"sprite",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=m))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/ItemBackContainer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemContainer.ts"],(function(n){var t,o,e,c;return{setters:[function(n){t=n.inheritsLoose},function(n){o=n.cclegacy,e=n._decorator},function(n){c=n.ItemContainer}],execute:function(){var r;o._RF.push({},"4fbcb5juVxPhbM0EpSPNFsZ","ItemBackContainer",void 0);var i=e.ccclass;e.property,n("ItemBackContainer",i("ItemBackContainer")(r=function(n){function o(){return n.apply(this,arguments)||this}t(o,n);var e=o.prototype;return e.onTouchEnd=function(n){},e.onTouchMove=function(n){},e.onTouchStart=function(n){},o}(c))||r);o._RF.pop()}}}));

System.register("chunks:///_virtual/ItemContainer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./TweenManager.ts"],(function(t){var e,n,i,o,s,c,h,r,a,l,d,u;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t._decorator,o=t.UITransform,s=t.Node,c=t.v3,h=t.v2,r=t.view,a=t.UIOpacity,l=t.Component},function(t){d=t.app},function(t){u=t.twn}],execute:function(){var g;n._RF.push({},"b75ebt49VBCUqnZuPsXO+XD","ItemContainer",void 0);var m=i.ccclass,p=(i.property,t("EItemEvent",{OnSelect:0,OnCancel:1,OnStartDrag:2,OnDrag:3,OnEmpty:4,OnDragEnd:5}));t("ItemContainer",m("ItemContainer")(g=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).item=null,e.isSelected=!1,e.event=d.gp.obs(),e.tweenInfo=null,e.moveDis=0,e.originPos=void 0,e.isInDrag=!1,e.selectSiblingIdx=0,e}e(n,t);var i=n.prototype;return i.onEnterOver=function(){},i.onExitOver=function(){},i.isPosInContainer=function(t){return this.node.getComponent(o).getBoundingBoxToWorld().contains(t)},i.getContainerWorldCenter=function(){return this.node.getComponent(o).getBoundingBoxToWorld().center},i.onLoad=function(){this.node.on(s.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(s.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(s.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(s.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},i.placeItem=function(t){this.item=t,this.isSelected=!1},i.swapItem=function(t){var e=t.item;t.placeItem(this.item),this.item&&(this.item.node.parent=t.node,this.item.node.position=c()),this.placeItem(e),e&&(e.node.parent=this.node,e.node.position=c())},i.onTouchStart=function(t){this.originPos=t.getUILocation(),this.isInDrag=!1},i.onTouchMove=function(t){var e=t.getUILocation(),n=e.clone().subtract(h(r.getVisibleSize().x/2,r.getVisibleSize().y/2));this.isInDrag||(this.moveDis=e.clone().subtract(this.originPos).length(),this.moveDis>10&&(this.isInDrag=!0,this.event.emit(p.OnStartDrag,this,n))),this.isInDrag&&this.event.emit(p.OnDrag,this,n)},i.onTouchEnd=function(t){var e=t.getUILocation();e.clone().subtract(h(r.getVisibleSize().x/2,r.getVisibleSize().y/2));this.isInDrag?this.event.emit(p.OnDragEnd,this,e):this.confirm()},i.confirm=function(){this.item&&!this.isSelected?(this.isSelected=!0,this.event.emit(p.OnSelect,this)):this.item&&this.isSelected?(this.isSelected=!1,this.event.emit(p.OnCancel,this)):this.item||this.event.emit(p.OnEmpty,this)},i.cancelSelect=function(){this.isSelected=!1,this.node.scale=c(1,1,1),this.node.setSiblingIndex(this.selectSiblingIdx)},i.select=function(){this.selectSiblingIdx=this.node.getSiblingIndex(),this.node.setSiblingIndex(-1),this.isSelected=!0,this.node.scale=c(1.2,1.2,1.2)},i.enterDrag=function(){this.item.getComponent(a).opacity=178.5},i.exitDrag=function(){this.item.getComponent(a).opacity=255},i.awaitToElimiate=function(){this.tweenInfo=u(this.node)},i.sparkleTips=function(){var t=this,e=this.node.getSiblingIndex();this.node.setSiblingIndex(-1),u(this.node).to(.3,{scale:c(1.5,1.5,1.5)}).to(.3,{scale:c(1,1,1)}).to(.3,{scale:c(1.5,1.5,1.5)}).to(.3,{scale:c(1,1,1)}).call((function(){t.node.setSiblingIndex(e)})).start()},n}(l))||g);n._RF.pop()}}}));

System.register("chunks:///_virtual/ItemFrame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Defer2.ts","./TweenManager.ts","./Utils2.ts","./FaceType.ts","./ItemBackContainer.ts","./ItemContainer.ts"],(function(n){var t,e,i,o,r,a,s,c,l,u,f,h,p,m,g,v,d,k,b,y,C,I,O,D;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,i=n.initializerDefineProperty,o=n.assertThisInitialized,r=n.createClass,a=n.asyncToGenerator},function(n){s=n.cclegacy,c=n._decorator,l=n.Prefab,u=n.Vec2,f=n.tween,h=n.v3,p=n.easing,m=n.UIOpacity,g=n.Component},function(n){v=n.app},function(n){d=n.Defer},function(n){k=n.twn},function(n){b=n.V3,y=n.trans},function(n){C=n.ElimiateId2Type},function(n){I=n.ItemBackContainer},function(n){O=n.ItemContainer,D=n.EItemEvent}],execute:function(){var w,E,F,S,B,P,T,M,z;s._RF.push({},"849d4CHlplKToAsBMVT8HF3","ItemFrame",void 0);var _=c.ccclass,A=c.property,V=n("EFrameEvent",{OnSelect:0,OnCancel:1,OnStartDrag:2,OnDrag:3,OnEmpty:4,OnDragEnd:5});n("ItemFrame",(w=_("ItemFrame"),E=A(l),F=A(O),S=A(I),w((T=t((P=function(n){function t(){for(var t,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return(t=n.call.apply(n,[this].concat(r))||this).layer=0,t.lock=!1,t.crd=void 0,i(t,"itemPrefab",T,o(t)),i(t,"containers",M,o(t)),i(t,"backContainers",z,o(t)),t.isInDrag=!1,t.event=v.gp.obs(),t}e(t,n);var s=t.prototype;return s.onEnterOver=function(){},s.onExitOver=function(){},s.findContainerByMinDist=function(n){var t=this.containers.find((function(t){return t.isPosInContainer(n)}));if(!t)return null;if(null!=t.item){for(var e=Number.MAX_VALUE,i=-1,o=0;o<this.containers.length;o++)if(null==this.containers[o].item&&null==this.containers[o].tweenInfo){var r=u.distance(this.containers[o].getContainerWorldCenter(),n);r<e&&(e=r,i=o)}-1!=i&&(t=this.containers[i])}return t},s.init=function(n,t,e){var i=this;this.crd=n,this.node.parent=t,this.node.position=b(e);for(var o=0;o<this.containers.length;o++){var r=this.containers[o];r.event.on(D.OnSelect,(function(n){i.lock||n.item&&i.event.emit(V.OnSelect,i,n)}),this),r.event.on(D.OnCancel,(function(n){i.lock||i.event.emit(V.OnCancel,i,n)}),this),r.event.on(D.OnDrag,(function(n,t){i.lock||n.item&&null==n.tweenInfo&&i.isInDrag&&i.event.emit(V.OnDrag,i,n,t)}),this),r.event.on(D.OnStartDrag,(function(n,t){i.lock||n.item&&null==n.tweenInfo&&!i.isInDrag&&(i.event.emit(V.OnStartDrag,i,n,t),i.isInDrag=!0)}),this),r.event.on(D.OnDragEnd,(function(n,t){i.lock||n.item&&null==n.tweenInfo&&i.isInDrag&&(i.event.emit(V.OnDragEnd,i,n,t),i.isInDrag=!1)}),this),r.event.on(D.OnEmpty,(function(n){i.lock||i.event.emit(V.OnEmpty,i,n)}),this)}},s.finishElimiate=function(){this.lock=!0,f(this.node).to(1,{scale:h()},{easing:p.backIn}).call((function(){})).start()},s.setBack=function(n){for(var t=0;t<this.backContainers.length;t++){var e=n[t];this.backContainers[t].placeItem(e),e&&(e.node.parent=this.backContainers[t].node,e.node.position=h(),e.node.scale=h(.8,.8,.8),e.node.getComponent(m).opacity=178.5)}},s.refreshMove=function(){var n=a((function*(n){var t=this,e=.5,i=[],o=function(n){var t=new d;i.push(t);for(var o=0;o<n.length;o++){var r=n[o];if(r){var a=r.getComponent(m);a.opacity=0,k(a).to(e,{opacity:178.5}).call((function(){return t.resolve()})).start()}}};if(0==this.backItems.length&&0==this.items.length&&n.length>0){for(var r=[],a=0;a<this.containers.length;a++)r.push(n.shift());for(var s=[],c=0;c<this.backContainers.length;c++)s.push(n.shift());this.setBack(s),o(s),this.setFront(r),function(n){for(var o=function(){var o=n[r];if(!o)return 1;var a=new d;i.push(a);var s=t.containers[r],c=t.backContainers[r],l=y(c.node,s.node);o.node.parent=s.node,o.node.position=l;var u=o.getComponent(m);u.opacity=0,o.node.scale=h(.8,.8,.8),k(u).to(e,{opacity:255}).start(),s.tweenInfo=k(o.node).to(e,{scale:h(1,1,1),position:h()},{easing:p.backOut}).call((function(){s.tweenInfo=null,a.resolve()})).start(),k(o.getComponent(m)).to(e,{opacity:255}).start()},r=0;r<t.containers.length;r++)o()}(r)}else if(this.backItems.length>0&&0==this.items.length){for(var l=[],u=0;u<this.backContainers.length;u++)l.push(this.backContainers[u].item);if(this.setFront(l),function(n){for(var i=function(){var i=n[o];if(!i)return 1;var r=new d,a=t.containers[o],s=t.backContainers[o],c=y(s.node,a.node);i.node.parent=a.node,i.node.position=c,i.getComponent(m).opacity=178.5,i.node.scale=h(.8,.8,.8),a.tweenInfo=k(i.node).to(e,{scale:h(1,1,1),position:h()},{easing:p.backOut}).call((function(){a.tweenInfo=null,r.resolve()})).start(),k(i.getComponent(m)).to(e,{opacity:255}).start()},o=0;o<t.containers.length;o++)i()}(l),n.length>0){for(var f=[],g=0;g<this.backContainers.length;g++)f.push(n.shift());this.setBack(f),o(f)}else this.setBack(this.backContainers.map((function(n){return null})))}else if(this.items.length>0&&0==this.backItems.length&&n.length>0){for(var v=[],b=0;b<this.backContainers.length;b++)v.push(n.shift());this.setBack(v),o(v)}yield Promise.all(i.map((function(n){return n.promise})))}));return function(t){return n.apply(this,arguments)}}(),s.setFront=function(n){var t=this;n.forEach((function(n,e){t.setFrontSingle(n,e)}))},s.setFrontSingle=function(n,t){this.containers[t].placeItem(n),n&&(n.node.parent=this.containers[t].node,n.node.position=h(),n.node.scale=h(1,1,1),n.node.getComponent(m).opacity=255)},s.cancelSelect=function(n){n.cancelSelect()},s.selectItem=function(n){n.select()},s.detectElimiate=function(){return C(this.items.map((function(n){return n.id})))},r(t,[{key:"backItems",get:function(){return this.backContainers.filter((function(n){return!!n.item})).map((function(n){return n.item}))}},{key:"items",get:function(){return this.containers.filter((function(n){return!!n.item})).map((function(n){return n.item}))}},{key:"isEmpty",get:function(){return!this.containers.some((function(n){return!!n.item}))}}]),t}(g)).prototype,"itemPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=t(P.prototype,"containers",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z=t(P.prototype,"backContainers",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),B=P))||B));s._RF.pop()}}}));

System.register("chunks:///_virtual/Map_ElimType.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Config.ts","./FaceType.ts","./MapAlgorithmBase.ts"],(function(n){var r,t,e,a,i,o,u;return{setters:[function(n){r=n.inheritsLoose},function(n){t=n.cclegacy,e=n._decorator},function(n){a=n.app},function(n){i=n.Config},function(n){o=n.ElimiateType},function(n){u=n.MapAlgorithmBase}],execute:function(){var f;t._RF.push({},"964bdYCz1FE1r2hSlf2a9dw","Map_ElimType",void 0);var c=e.ccclass;n("MapElimType",c("MapElimType")(f=function(n){function t(){return n.apply(this,arguments)||this}r(t,n);var e=t.prototype;return e.propRefresh=function(n){return this.defaultPropRefresh(n)},e.generateMap=function(){return this.defaultGenMap(i.ElimTypeLevelConfig.get(this.id).frameNum)},e.generateItem=function(){var n=this,r=[[[[1,1,1],[6,6,6],[8,8,8]],[[2,3,4]]],[[[2,2,2],[3,3,3],[9,9,9]],[[5,6,7]]],[[[5,5,5],[6,6,6],[9,9,9]],[[1,2,3]]],[[[1,1,1]],[[3,4,5],[7,8,9]]],[[[7,7,7],[8,8,8]],[[3,4,5]]],[[[1,1,1],[2,2,2]],[[4,5,6]]],[[[4,4,4]],[[1,2,3],[6,7,8]]]],t=[],e=new Map,u=i.ElimTypeLevelConfig.get(this.id);e.set(o.Chi,u.contNum),e.set(o.Peng,u.pairNum);for(var f=[],c=28;c<=34;c++)f.push([c,c,c]);for(var g=function(i){for(var u=a.gp.rng.arrRand(r),c=Math.round(a.gp.rng.rand(0,e.get(o.Peng))),g=function(){var r=[];u[0].forEach((function(n,t){r.push([]),n.forEach((function(n,e){r[t].push(n+9*i)}))})),a.gp.rng.arrRand([].concat(r,f)).forEach((function(r){return t.push(n.gen(r))}))},p=0;p<c;p++)g();e.set(o.Peng,e.get(o.Peng)-c);for(var s=Math.round(a.gp.rng.rand(0,e.get(o.Chi))),h=0;h<s;h++){a.gp.rng.arrRand(u[1]).forEach((function(r){return t.push(n.gen(r+9*i))}))}e.set(o.Chi,e.get(o.Chi)-s)},p=0;p<3;p++)g(p);if(e.get(o.Peng)>0)for(var s=e.get(o.Peng),h=function(){var e=[],i=a.gp.rng.arrRand([0,1,2]);a.gp.rng.arrRand(r)[0].forEach((function(n,r){e.push([]),n.forEach((function(n,t){e[r].push(n+9*i)}))})),a.gp.rng.arrRand([].concat(e,f)).forEach((function(r){return t.push(n.gen(r))}))},d=0;d<s;d++)h();if(e.get(o.Chi)>0)for(var l=e.get(o.Chi),m=function(){var e=[].concat(a.gp.rng.arrRand(r)[1]),i=a.gp.rng.arrRand([0,1,2]);e.forEach((function(n,r){return n.forEach((function(n,t){return e[r][t]+=9*i}))})),a.gp.rng.arrRand([].concat(e,f)).forEach((function(r){return t.push(n.gen(r))}))},v=0;v<l;v++)m();return t},e.distributeItem=function(n,r){return this.defaultdistributeItem(n,r,i.ElimTypeLevelConfig.get(this.id).emptyList)},e.genItemToFrame=function(n){this.defaultGenItemToFrame(n)},e.avoidElimiate=function(n){this.defaultAvoidElimiate(n)},t}(u))||f);t._RF.pop()}}}));

System.register("chunks:///_virtual/Map_FaceType.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Config.ts","./Utils2.ts","./FaceType.ts","./Item.ts","./MapAlgorithmBase.ts"],(function(e){var t,n,r,a,i,o,u,p,s;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,r=e._decorator},function(e){a=e.app},function(e){i=e.Config},function(e){o=e.sum},function(e){u=e.EFaceType},function(e){p=e.Item},function(e){s=e.MapAlgorithmBase}],execute:function(){var f;n._RF.push({},"e2ad5rPb6ZCkLOHDUTFUScS","Map_FaceType",void 0);var c=r.ccclass;e("MapFaceType",c("MapFaceType")(f=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var r=n.prototype;return r.propRefresh=function(e){return this.defaultPropRefresh(e)},r.generateMap=function(){return this.defaultGenMap(i.FaceTypeLevelConfig.get(this.id).frameNum)},r.generateItem=function(){for(var e=this,t=[],n=[[3,3,1],[3,3],[3,1,3],[3,3],[3,3],[3,3,1],[3,1,1,1,1]],r=i.FaceTypeLevelConfig.get(this.id),s=r.typeWei,f=r.allGroupNum,c=r.typeNumList,g=new Map,l=o(s),h=0;h<s.length;h++){var m=s[h];g.set(h,Math.round(f*m/l))}for(var v=[[[1,2,3],[5,6,7],[9,9,9]],[[1,2,3],[6,7,8]],[[1,2,3],[5,5,5],[7,8,9]],[[2,3,4],[6,7,8]],[[2,3,4],[7,8,9]],[[3,4,5],[7,8,9],[1,1,1]],[[4,5,6],[1,1,1],[2,2,2],[8,8,8],[9,9,9]]],d=[],y=function(e){var t=[],r=c[e];if(r<=0)return 1;for(var i=n.map((function(e){return[Math.min.apply(Math,e),o(e)]})),u=[],p=0;p<i.length;p++)i[p][1]>=r&&i[p][0]<=r&&u.push(p);for(var s=a.gp.rng.arrRand(u),f=[].concat(v[s]).sort((function(){return Math.random()-.5})),l=0,h=0;h<f.length;h++){var m=new Set(f[h]).size;l+m<=r&&(l+=m,t.push(f[h].map((function(t){return t+9*e}))))}for(var y=g.get(e),F=0;F<y;F++){var M=a.gp.rng.arrRand(t);d.push(M)}},F=0;F<3;F++)y(F);for(var M,T,L=a.gp.rng.weiRandMulAverage([[28,28,28],[29,29,29],[30,30,30],[31,31,31],[32,32,32],[33,33,33],[34,34,34]],c[3],!1),C=g.get(u.Zi),R=0;R<C;R++){var I=a.gp.rng.arrRand(L);d.push(I)}a.gp.rng.suffle(d,i.FaceTypeLevelConfig.get(this.id).suffleTimes);for(var _=0;_<d.length;_++)for(var b=d[_],A=0;A<b.length;A++)M=b[A],T=void 0,(T=a.gp.get(e.itemPrefab).getComponent(p)).init(M),t.push(T);return t},r.distributeItem=function(e,t){return this.defaultdistributeItem(e,t,i.FaceTypeLevelConfig.get(this.id).emptyList)},r.genItemToFrame=function(e){this.defaultGenItemToFrame(e)},r.avoidElimiate=function(e){return this.defaultAvoidElimiate(e)},n}(s))||f);n._RF.pop()}}}));

System.register("chunks:///_virtual/Map_Fixed.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./ItemFrame.ts","./MapAlgorithmBase.ts"],(function(t){var e,r,n,a,i,s;return{setters:[function(t){e=t.inheritsLoose},function(t){r=t.cclegacy,n=t._decorator},function(t){a=t.app},function(t){i=t.ItemFrame},function(t){s=t.MapAlgorithmBase}],execute:function(){var p;r._RF.push({},"403aaODlWNCnKFJLfiP/F/v","Map_Fixed",void 0);var l=n.ccclass;t("MapFixed",l("MapFixed")(p=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).map=[],e.frameItemsMap=new Map,e}e(r,t);var n=r.prototype;return n.propRefresh=function(t){return t},n.generateMap=function(){var t=this,e=a.manager.res.getLevel(this.id);if(e){for(var r=e.text.split("\r\n"),n=0;n<r.length;n++)if(""!=r[n]){var s=r[n].split(",");this.map.push([]);for(var p=0;p<s.length;p++)if(s[p].includes("#"))this.map[n].push(null);else{this.map[n].push([]);for(var l=s[p].split("|"),h=0;h<l.length;h++){this.map[n][p].push([]);for(var o=l[h].split(";"),u=0;u<o.length;u++)if("n"==o[u])this.map[n][p][h].push(null);else{var f=parseInt(o[u]);this.map[n][p][h].push(f)}}}}}else console.error("找不到关卡：",this.id);this.map=this.map.reverse();var m=this.map.length,c=this.map[0].length,g=a.gp.createGrid((function(e){return null==t.map[e.y][e.x]?null:a.gp.get(t.framePrefab).getComponent(i)}),this.root,[this.root],null,c,m,this.wid,this.hei),v=g.filterGrid((function(t){return null!=t}));this.frameItemsMap=new Map;for(var d=0;d<v.length;d++){for(var M=v[d],F=this.map[M.crd.y][M.crd.x],I=[],y=0;y<F.length;y++)for(var x=0;x<F[y].length;x++)null!=F[y][x]?I.push(this.gen(F[y][x])):I.push(null);this.frameItemsMap.set(M,I)}return this.gd=g,v},n.generateItem=function(){for(var t=Array.from(this.frameItemsMap.values()),e=[],r=0;r<t.length;r++)e.push.apply(e,t[r]);return e},n.distributeItem=function(t,e){return this.frameItemsMap},n.genItemToFrame=function(t){this.defaultGenItemToFrame(t)},n.avoidElimiate=function(t){},r}(s))||p);r._RF.pop()}}}));

System.register("chunks:///_virtual/Map_Rand.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Config.ts","./ItemFrame.ts","./MapAlgorithmBase.ts"],(function(t){var e,n,r,i,o,a,u;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,r=t._decorator},function(t){i=t.app},function(t){o=t.Config},function(t){a=t.ItemFrame},function(t){u=t.MapAlgorithmBase}],execute:function(){var s;n._RF.push({},"5c072q3tB1An4/xSGoiLCZ7","Map_Rand",void 0);var c=r.ccclass;t("MapRand",c("MapRand")(s=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.propRefresh=function(t){return t},r.generateMap=function(){var t=this;return i.gp.createGrid((function(e){return i.gp.get(t.framePrefab).getComponent(a)}),this.root,[this.root],null,3,5,this.wid,this.hei).filterGrid((function(t){return!0}))},r.generateItem=function(){for(var t=o.RandLevelConfig.get(this.id).groupNum,e=[],n=0;n<t;n++){var r=i.gp.rng.rand(0,34);e.push(this.gen(r))}return e.sort((function(){return Math.random()-.5}))},r.distributeItem=function(t,e){return this.defaultdistributeItem(t,e,o.ElimTypeLevelConfig.get(this.id).emptyList)},r.genItemToFrame=function(t){return this.defaultGenItemToFrame(t)},r.avoidElimiate=function(t){this.defaultAvoidElimiate(t)},n}(u))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/MapAlgorithmBase.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Utils2.ts","./FaceType.ts","./Item.ts","./ItemFrame.ts"],(function(t){var n,e,r,i,o,a,u,s,f,h,c,l;return{setters:[function(t){n=t.asyncToGenerator},function(t){e=t.cclegacy,r=t.v2,i=t.v3,o=t.tween,a=t.easing},function(t){u=t.app},function(t){s=t.delay},function(t){f=t.ElimiateId2Type,h=t.ElimiateType},function(t){c=t.Item},function(t){l=t.ItemFrame}],execute:function(){e._RF.push({},"0be03ktdCFKnJli5/8o3DT3","MapAlgorithmBase",void 0);var g=t("EMapGenEvent",{Success:"MapGenSuccess",Fail:"MapGenFail"});t("MapAlgorithmBase",function(){function t(){this.event=u.gp.obs(),this.gd=null,this.id=0,this.framePrefab=null,this.itemPrefab=null,this.root=null,this.wid=0,this.hei=0}var e=t.prototype;return e.setId=function(t,n,e,r,i,o){this.framePrefab=n,this.itemPrefab=e,this.wid=i,this.hei=o,this.root=r,this.id=t},e.genFullFrame15=function(){var t=this;return u.gp.createGrid((function(n){return u.gp.get(t.framePrefab).getComponent(l)}),this.root,[this.root],null,3,5,this.wid,this.hei)},e.genDiamondFrame4=function(){var t=this;return u.gp.createGrid((function(n){return 1==Math.abs(n.x-n.y)?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genGongFrame7=function(){var t=this,n=[r(0,0),r(1,0),r(2,0),r(1,1),r(0,2),r(1,2),r(2,2)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genHFrame7=function(){var t=this,n=[r(0,0),r(0,1),r(0,2),r(1,1),r(2,0),r(2,1),r(2,2)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genFourFrame4=function(){var t=this,n=[r(0,0),r(2,0),r(0,2),r(2,2)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genRectFrame8=function(){var t=this,n=[r(0,0),r(1,0),r(2,0),r(0,1),r(2,1),r(0,2),r(1,2),r(2,2)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genXFrame5=function(){var t=this,n=[r(0,0),r(2,0),r(1,1),r(0,2),r(2,2)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genAddFrame5=function(){var t=this,n=[r(1,0),r(0,1),r(1,1),r(2,1),r(1,2)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genFullFrame9=function(){var t=this;return u.gp.createGrid((function(n){return u.gp.get(t.framePrefab).getComponent(l)}),this.root,[this.root],null,3,3,this.wid,this.hei)},e.genHorzFrame6=function(){var t=this,n=[r(0,0),r(1,0),r(2,0),r(0,1),r(1,1),r(2,1)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,3,2,this.wid,this.hei)},e.genVertFrame6=function(){var t=this,n=[r(0,0),r(0,1),r(0,2),r(1,0),r(1,1),r(1,2)];return u.gp.createGrid((function(e){return n.findIndex((function(t){return t.equals(e)}))>=0?u.gp.get(t.framePrefab).getComponent(l):null}),this.root,[this.root],null,2,3,this.wid,this.hei)},e.gen=function(t){var n=u.gp.get(this.itemPrefab).getComponent(c);return n.init(t),n},e.defaultGenMap=function(t){var n=[[],[],[],[],[this.genFourFrame4,this.genDiamondFrame4],[this.genXFrame5,this.genAddFrame5],[this.genHorzFrame6,this.genVertFrame6],[this.genHFrame7,this.genGongFrame7],[this.genRectFrame8],[this.genFullFrame9]];this.gd=u.gp.rng.arrRand(n[t]).call(this);var e=this.gd.filterGrid((function(t){return!0}));return e.forEach((function(t){return t.lock=!1})),e},e.playItemFrameEnterAnim=function(){var t=n((function*(){var t=r(Math.floor(this.gd.col/2),Math.floor(this.gd.row/2)),n=this.gd.bfs(t,(function(t){return!!t}));n.forEach((function(t){t.node.scale=i(0,0,0)}));for(var e=0;e<n.length;e++){var u=n[e];o(u.node).to(.5,{scale:i(1,1,1)},{easing:a.backOut}).start(),yield s(100)}yield s(400)}));return function(){return t.apply(this,arguments)}}(),e.defaultGenItemToFrame=function(t){t.forEach((function(t,n){for(var e=[],r=0;r<n.containers.length;r++)e.push(t.shift());for(var i=[],o=0;o<n.backContainers.length;o++)i.push(t.shift());n.setFront(e),n.setBack(i)}))},e.defaultAvoidElimiate=function(t){for(var n=this,e=!0,r=function(t,n,e,r){var i=t.containers.map((function(t){return t.item})),o=e.backItems,a=i.indexOf(n),u=o.indexOf(r),s=i[a];i[a]=o[u],o[u]=s,t.setFront(i),e.setBack(o)};e;){e=!1;for(var i,o=function(){if(f(t[a].items.map((function(t){return t?t.id:-1})))!=h.None){var i=u.gp.rng.arrRand(t[a].containers).item,o=t[a],s=t.find((function(t){return t.backItems.some((function(t){return!!t!=!!i||t.id!=i.id}))}));if(!s)return console.error("无法避免三消"),n.event.emit(g.Fail),{v:void 0};var c=s.backItems.find((function(t){return!!t!=!!i||t.id!=i.id}));r(o,i,s,c),e=!0}},a=0;a<t.length;a++)if(i=o())return i.v}},e.defaultdistributeItem=function(t,n,e){var r=[].concat(n),i=t.filter((function(t){return 0==t.lock})),o=t[0].containers.length,a=i.length*o,s=new Map,f=new Map,h=0,c=function(){var t=0;return f.forEach((function(n,e){for(var r=0;r<n.length;r++)null!=n[r]&&t++})),t},l=function(){var t=[];return f.forEach((function(n,e){n.length<o&&!e.lock&&t.push(e)})),t},g=function(){for(var n=0;n<t.length;n++)f.set(t[n],[])},m=function(){f.forEach((function(t,n){var e,r=[];if(t.length>0){for(var i=0;i<o;i++)i<t.length?r.push(t[i]):r.push(null);r.sort((function(){return Math.random()-.5}))}s.has(n)||s.set(n,[]),(e=s.get(n)).push.apply(e,r)}))};for(g();r.length>0;){var d=r.shift(),p=u.gp.rng.arrRand(l());f.get(p).push(d),0==h&&n.length;var v=a-e[e.length-1];h<e.length&&(v=a-e[h]),c()>=v&&(h++,m(),g())}return c()>0&&m(),s},e.defaultPropRefresh=function(t){var n=[],e=Array.from(t.keys());e.forEach((function(e){e.containers.forEach((function(t){var e;null==(e=t.tweenInfo)||e.stop(),t.item&&n.push(t.item),t.item&&t.item.node.removeFromParent(),t.placeItem(null)})),e.backContainers.forEach((function(t){var e;null==(e=t.tweenInfo)||e.stop(),t.item&&n.push(t.item),t.item&&t.item.node.removeFromParent(),t.placeItem(null)})),t.get(e).forEach((function(t){return t&&n.push(t)}))}));var r=this.distributeItem(e,n);return this.genItemToFrame(r),this.avoidElimiate(e),r},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/MapCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Config.ts","./Defer2.ts","./TweenManager.ts","./Utils2.ts","./ComboCtrl.ts","./FaceType.ts","./Item.ts","./ItemFrame.ts","./MapAlgorithmBase.ts"],(function(e){var t,n,i,r,a,o,l,m,s,c,u,f,p,d,h,g,v,b,y,I,E,w,C,F,T,N,P,M,G,k,L,O,x,z,B;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.asyncToGenerator,o=e.createClass},function(e){l=e.cclegacy,m=e._decorator,s=e.Node,c=e.AnimationComponent,u=e.Prefab,f=e.ProgressBar,p=e.Label,d=e.easing,h=e.v3,g=e.Component,v=e.v2,b=e.Color,y=e.js,I=e.UIOpacity},function(e){E=e.app},function(e){w=e.Config},function(e){C=e.Defer},function(e){F=e.twn},function(e){T=e.V3,N=e.trans,P=e.time2str,M=e.V2},function(e){G=e.ComboCtrl,k=e.EComboEvent},function(e){L=e.ElimiateType,O=e.ElimiateId2Type},function(e){x=e.Item},function(e){z=e.EFrameEvent},function(e){B=e.EMapGenEvent}],execute:function(){var S,A,D,R,H,j,q,W,_,U,V,Y,J,K,Q,X,Z,$,ee,te,ne,ie,re,ae,oe,le,me,se,ce;l._RF.push({},"7736fqOO0FEOqqoVxgIfLxb","MapCtrl",void 0);var ue=m.ccclass,fe=m.property,pe="gameTimer",de=e("EMapEvent",{GameStart:0,GameReady:1,TimeOver:2,GameFinish:3,FullItem:4,PropLack:5,SecondTick:6,EnterTween:7,ExitTween:8});e("MapCtrl",(S=ue("MapCtrl"),A=fe(s),D=fe(c),R=fe(u),H=fe(u),j=fe(s),q=fe(Number),W=fe(f),_=fe(p),U=fe(f),V=fe(p),S(((ce=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).event=E.gp.obs(),i(t,"layerNodes",K,r(t)),i(t,"anim",Q,r(t)),i(t,"row",X,r(t)),i(t,"col",Z,r(t)),i(t,"gridWid",$,r(t)),i(t,"gridHei",ee,r(t)),i(t,"framePrefab",te,r(t)),i(t,"itemPrefab",ne,r(t)),i(t,"elimiatePreviewNodes",ie,r(t)),t.selectedItem=null,t.selectedFrame=null,t.previewNode=null,i(t,"emptyNumList",re,r(t)),i(t,"groupTypeNum",ae,r(t)),t.allFrames=[],t.mapGenCls=null,t.allItems=[],t.frameItemsMap=new Map,t.comboCtrl=null,i(t,"comboBar",oe,r(t)),i(t,"comboLabel",le,r(t)),i(t,"timeBar",me,r(t)),i(t,"timeLbl",se,r(t)),t.remainTime=0,t}n(t,e);var l=t.prototype;return l.load=function(){var e=a((function*(){var e=this;window.map=this,t.Ins=this,this.loadCombo(),this.gameInit();for(var n=!0,i=0,r=function*(){if(++i>100)return console.error("关卡生成失败：",e.levelCfg.level),E.manager.ui.showToast("关卡生成失败"),E.manager.ui.show({name:"PageHome"}),1;n=!1,e.allItems=[],e.frameItemsMap=new Map,[].concat(e.layerNodes[0].children).forEach((function(e){return e.destroy()}));var t=e.mapGenCls=new(y.getClassByName(e.levelCfg.algorithm));t.event.on(B.Fail,(function(){n=!0,t.event.offAll()}),e),t.setId(e.levelCfg.genId,e.framePrefab,e.itemPrefab,e.layerNodes[0],e.gridWid,e.gridHei),!n&&(e.allFrames=t.generateMap()),!n&&e.bindEvent(),!n&&(e.allItems=t.generateItem()),!n&&(e.frameItemsMap=t.distributeItem(e.allFrames,e.allItems)),!n&&t.genItemToFrame(e.frameItemsMap),!n&&t.avoidElimiate(e.allFrames)};n&&!(yield*r()););this.judgeFullGen(),this.event.emit(de.GameReady),yield this.mapGenCls.playItemFrameEnterAnim(),this.anim.play("GO"),E.manager.sound.playEffect({name:"effect/GO"}),this.anim.once(c.EventType.FINISHED,(function(){e.event.emit(de.GameStart)}))}));return function(){return e.apply(this,arguments)}}(),l.exit=function(){E.manager.event.targetOff(this),E.manager.timer.get(pe).unscheduleAllCallbacks()},l.judgeFullGen=function(){this.allFrames.some((function(e){return e.items.length<e.containers.length}))||this.propRefresh()},l.bindEvent=function(){for(var e=this,t=this.allFrames,n=0;n<t.length;n++){var i=t[n];i.event.on(z.OnSelect,(function(t,n){null!=e.selectedItem&&e.selectedItem!=n&&e.selectedFrame.cancelSelect(e.selectedItem),e.selectedItem=n,e.selectedFrame=t,e.selectedFrame.selectItem(e.selectedItem),E.manager.sound.playEffect({name:"effect/pickup"})}),this),i.event.on(z.OnCancel,(function(t,n){null!=e.selectedItem&&e.selectedFrame.cancelSelect(e.selectedItem),e.selectedItem=null,e.selectedFrame=null}),this),i.event.on(z.OnStartDrag,(function(t,n,i){var r;null==(r=e.previewNode)||r.destroy(),null!=e.selectedItem&&e.selectedItem!=n&&e.selectedFrame.cancelSelect(e.selectedItem),e.selectedItem=n,e.selectedFrame=t,e.previewNode=e.newPreview(e.selectedItem.item),n.enterDrag(),E.manager.sound.playEffect({name:"effect/pickup"})}),this),i.event.on(z.OnDrag,(function(t,n,i){e.previewNode&&(e.previewNode.position=T(i))}),this),i.event.on(z.OnDragEnd,(function(t,n,i){var r;null==(r=e.previewNode)||r.destroy(),n.exitDrag();var a=e.selectedItem.item,o=i;e.allFrames;E.manager.sound.playEffect({name:"effect/put"});var l=e.findInfoInPoint(o),m=l.item,s=l.frame;m&&n!=m&&null==m.item&&null==m.tweenInfo&&(a.node.parent=e.layerNodes[1],a.node.position=e.previewNode.position,e.place(t,s,n,m)),e.selectedFrame.cancelSelect(e.selectedItem),e.selectedFrame=null,e.selectedItem=null}),this),i.event.on(z.OnEmpty,(function(t,n){e.selectedItem&&(e.place(e.selectedFrame,t,e.selectedItem,n),e.selectedItem=null,e.selectedFrame=null,E.manager.sound.playEffect({name:"effect/put"}))}),this)}},l.findInfoInPoint=function(e){for(var t=this.allFrames,n=0;n<t.length;n++){var i=t[n].findContainerByMinDist(e);if(i)return{frame:t[n],item:i}}return{frame:null,item:null}},l.detectFrameEmpty=function(){var e=a((function*(e){if(e.isEmpty){var t=e.refreshMove(this.frameItemsMap.get(e));this.event.emit(de.EnterTween,t),yield t,this.event.emit(de.ExitTween,t),e.detectElimiate()!=L.None&&(yield this.elimiateFrame(e))}}));return function(t){return e.apply(this,arguments)}}(),l.detectGame=function(){var e=a((function*(){var e=this,t=function(){for(var t=[],n=e.allFrames,i=0;i<n.length;i++)t.push.apply(t,n[i].containers.map((function(e){return e.tweenInfo?e.tweenInfo.promise:null})));return Promise.all(t)};this.allFrames.some((function(e){return e.items.length<3}))?this.allFrames.some((function(e){return e.items.length>0}))||(yield t(),this.event.emit(de.GameFinish)):(yield t(),this.event.emit(de.FullItem))}));return function(){return e.apply(this,arguments)}}(),l.place=function(){var e=a((function*(e,t,n,i){var r=n.item;e.cancelSelect(n),i.placeItem(r),n.placeItem(null);var a=this.moveItem(r,i);n.tweenInfo=a,i.tweenInfo=a,this.event.emit(de.EnterTween,a.promise),yield n.tweenInfo.promise,this.event.emit(de.ExitTween,a.promise),n.tweenInfo=null,i.tweenInfo=null,this.detectFrameEmpty(e),t.detectElimiate()!=L.None&&(yield this.elimiateFrame(t)),this.detectGame()}));return function(t,n,i,r){return e.apply(this,arguments)}}(),l.moveItem=function(e,t){var n=N(e.node,this.layerNodes[1]),i=N(t.node,this.layerNodes[1]);return e.node.parent=this.layerNodes[0],e.node.position=n,F(e.node).to(.5,{position:i},{easing:d.quadOut}).call(a((function*(){e.node.parent=t.node,e.node.position=h(0,0,0)}))).reject((function(){e.node.position=h()})).start()},l.newPreview=function(e){var t=E.gp.get(this.itemPrefab);return t.parent=this.layerNodes[1],t.getComponent(x).init(e.id),t},l.elimiateItem=function(){var e=a((function*(e,t){var n=this;this.allItems.splice(this.allItems.indexOf(t),1);var i=new C;return e.tweenInfo=F(t.node).to(.5,{scale:h(0,0,0)},{easing:d.backIn}).call((function(){e.tweenInfo=null,t.node.scale=h(1,1,1),t.node.active=!1,E.gp.put(t.node);var r=n.effectNode,a=N(e.node,r);E.gp.eff.emit(E.manager.res.getSprite("quad"),M(a),v(5,10),v(3,8),v(0,360),v(.5,1),v(25,100),[b.WHITE,b.RED,b.CYAN,b.GREEN,b.BLUE],r),i.resolve()})).start(),i.promise}));return function(t,n){return e.apply(this,arguments)}}(),l.elimiateFrame=function(){var e=a((function*(e){var t=this;e.containers.forEach((function(e){e.awaitToElimiate()}));var n=O(e.items.map((function(e){return e.id})));if(n!=L.None){e.containers.forEach((function(e){var n=e.item;n&&(e.placeItem(null),t.elimiateItem(e,n))}));var i=Promise.all(e.containers.map((function(e){return e.tweenInfo.promise})));this.event.emit(de.EnterTween,i),yield i,this.event.emit(de.ExitTween,i),this.playElimiateEffect(n,e.node),this.comboCtrl.addCombo(),this.detectFrameEmpty(e)}}));return function(t){return e.apply(this,arguments)}}(),l.playElimiateEffect=function(e,t){var n=this;if(e!=L.None){E.api.sdk.API.vibrate();var i=function(e){e.parent=n.effectNode,e.position=N(t,n.effectNode).add(h(100*Math.random()-50,100*Math.random()-50,0));var i=e.getComponent(c);i.play("effectLight"),i.once(c.EventType.FINISHED,(function(){E.gp.put(e)}))};if(E.manager.sound.playEffect({name:"effect/achieve"}),e==L.Chi)i(E.gp.get(E.manager.res.getPrefab("chiEffect"))),E.manager.sound.playEffect({name:"effect/chi"});else if(e==L.Peng){i(E.gp.get(E.manager.res.getPrefab("pengEffect"))),E.manager.sound.playEffect({name:"effect/peng"})}}},l.loadCombo=function(){var e=this;this.comboCtrl=new G,this.comboCtrl.init(),this.comboBar.node.active=!1,this.comboLabel.node.active=!1,this.comboCtrl.event.on(k.TickCombo,(function(t){return e.comboBar.progress=t}),this),this.comboCtrl.event.on(k.NewCombo,(function(t){e.comboBar.node.active=!0,e.comboLabel.string=t+"连击",e.comboLabel.node.active=!0}),this),this.comboCtrl.event.on(k.EndCombo,(function(t){e.comboBar.node.active=!1,e.comboLabel.node.active=!1}),this)},l.gameExit=function(){this.gamePause()},l.gamePause=function(){E.manager.timer.get(pe).unscheduleAllCallbacks()},l.gameResume=function(){E.manager.timer.get(pe).schedule(this.onTickGameTime.bind(this),1)},l.gameInit=function(){E.manager.timer.get(pe).unscheduleAllCallbacks(),E.manager.timer.get(pe).schedule(this.onTickGameTime.bind(this),1),this.remainTime=E.config.game.gameTime,this.timeBar.progress=1,this.timeLbl.string=P(E.config.game.gameTime)},l.onTickGameTime=function(){this.event.emit(de.SecondTick),this.remainTime=Math.max(0,this.remainTime-1),this.timeBar.progress=this.remainTime/E.config.game.gameTime,this.timeLbl.string=P(this.remainTime),this.remainTime<=0&&(E.manager.timer.get(pe).unscheduleAllCallbacks(),this.event.emit(de.TimeOver))},l.propTips=function(){var e=this.findItemsCanElimiate();null!=e?e.forEach((function(e){return e.sparkleTips()})):E.manager.ui.showToast("请移出更多下层麻将")},l.propElimiate=function(){var e=a((function*(){var e=this,t=this.findItemsCanElimiate();if(null!=t){var n=O(t.map((function(e){return e.item.id}))),i=[],r=t.map((function(e){return e.item}));t.forEach((function(e){return e.placeItem(null)}));for(var o=function*(n){var o=e.elimiatePreviewNodes[n],l=r[n],m=N(l.node,o);l.node.parent=e.elimiatePreviewNodes[n],l.node.position=m;var s=new C;F(l.node.getComponent(I)).to(.3,{opacity:255}).start(),F(l.node).to(.5,{position:h(),scale:h(1,1,1)},{easing:d.quadOut}).call(a((function*(){yield e.elimiateItem(t[n],l),s.resolve()}))).start(),i.push(s.promise)},l=0;l<r.length;l++)yield*o(l);var m=new Set(t.map((function(t){return e.allFrames.find((function(e){return e.containers.indexOf(t)>=0||e.backContainers.indexOf(t)>=0}))})));Array.from(m).forEach((function(t){return e.detectFrameEmpty(t)}));var s=Promise.all(i);this.event.emit(de.EnterTween,s),yield s,this.event.emit(de.ExitTween,s),this.comboCtrl.addCombo(),this.playElimiateEffect(n,this.elimiatePreviewNodes[1]),this.detectGame()}else E.manager.ui.showToast("请移出更多下层麻将")}));return function(){return e.apply(this,arguments)}}(),l.propRefresh=function(){var e=this,t=[];this.allFrames.forEach((function(n){n.containers.forEach((function(e){var n;null==(n=e.tweenInfo)||n.stop(),e.item&&t.push(e.item),e.item&&e.item.node.removeFromParent(),e.placeItem(null)})),n.backContainers.forEach((function(e){var n;null==(n=e.tweenInfo)||n.stop(),e.item&&t.push(e.item),e.item&&e.item.node.removeFromParent(),e.placeItem(null)})),e.frameItemsMap.get(n).forEach((function(e){return e&&t.push(e)})),e.frameItemsMap.set(n,[])})),this.frameItemsMap=this.mapGenCls.distributeItem(this.allFrames,t),this.mapGenCls.genItemToFrame(this.frameItemsMap),this.mapGenCls.avoidElimiate(this.allFrames),this.judgeFullGen()},l.findItemsCanElimiate=function(){var e=this,t=function(t){for(var n=new Map,i=0;i<t.length;i++){var r=t[i];r.item&&null==r.tweenInfo&&n.set(r.item.id,n.has(r.item.id)?n.get(r.item.id)+1:1)}var a=-1,o=e.allFrames[0].containers.length;n.forEach((function(e,t){return e>=o&&(a=t)}));var l=[];if(a<0)l=[];else{var m=t.filter((function(e){return e.item&&null==e.tweenInfo&&e.item.id==a}));l=E.gp.rng.weiRandMulAverage(m,3,!1)}for(var s=Array.from(n.keys()).sort(),c=[],u=0;u<s.length-2;u++)s[u+1]-s[u]==1&&s[u+2]-s[u+1]==1&&c.push([s[u],s[u+1],s[u+2]]);var f=c.findIndex((function(e){return e.some((function(e){return e>27}))}));f>=0&&c.splice(f);for(var p=function(){var e=9*d+.5;c.filter((function(t){return(t[0]-e)*(t[2]-e)<0})).forEach((function(e){c.splice(c.indexOf(e),1)}))},d=0;d<3;d++)p();var h=[],g=E.gp.rng.arrRand(c);return g&&(h=g.map((function(e){return t.find((function(t){return t.item&&null==t.tweenInfo&&t.item.id==e}))}))),0==l.length&&h.length>0?h:l.length>0&&0==h.length?l:l.length>0&&h.length>0?Math.random()>.5?l:h:null},n=[];this.allFrames.forEach((function(e){var t;return(t=n).push.apply(t,e.containers)}));var i=t(n);return i||(n=[],this.allFrames.forEach((function(e){var t;return(t=n).push.apply(t,e.containers.concat(e.backContainers))})),(i=t(n))||null)},o(t,[{key:"effectNode",get:function(){return this.layerNodes[2]}},{key:"layerNum",get:function(){return this.emptyNumList.length}},{key:"levelCfg",get:function(){return w.LevelConfig.get(E.data.storage.level)}}]),t}(g)).Ins=void 0,K=t((J=ce).prototype,"layerNodes",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=t(J.prototype,"anim",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(J.prototype,"row",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Z=t(J.prototype,"col",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),$=t(J.prototype,"gridWid",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 238}}),ee=t(J.prototype,"gridHei",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 157}}),te=t(J.prototype,"framePrefab",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne=t(J.prototype,"itemPrefab",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie=t(J.prototype,"elimiatePreviewNodes",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),re=t(J.prototype,"emptyNumList",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ae=t(J.prototype,"groupTypeNum",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),oe=t(J.prototype,"comboBar",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=t(J.prototype,"comboLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=t(J.prototype,"timeBar",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),se=t(J.prototype,"timeLbl",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=J))||Y));l._RF.pop()}}}));

System.register("chunks:///_virtual/page-game",["./PageGame.ts","./ComboCtrl.ts","./FaceType.ts","./Item.ts","./ItemBackContainer.ts","./ItemContainer.ts","./ItemFrame.ts","./MapCtrl.ts","./MapAlgorithmBase.ts","./Map_ElimType.ts","./Map_FaceType.ts","./Map_Fixed.ts","./Map_Rand.ts","./PropBtn.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PageGame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseView.ts","./app.ts","./Const.ts","./MapCtrl.ts","./Map_Fixed.ts","./PropBtn.ts"],(function(e){var n,t,i,a,o,r,s,p,u,m,c,h,l,f,d,v,g,w;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator},function(e){r=e.cclegacy,s=e._decorator,p=e.Label,u=e.Node},function(e){m=e.default},function(e){c=e.app},function(e){h=e.EventConst},function(e){l=e.MapCtrl,f=e.EMapEvent},function(e){d=e.MapFixed},function(e){v=e.PropBtn,g=e.EPropBtnEvent,w=e.EPropBtnRequest}],execute:function(){var P,b,y,B,T,k,E,R,L,G,M;r._RF.push({},"f7842QyVsxKP5lSzLu33hbr","PageGame",void 0);var C=s.ccclass,S=s.property;e("PageGame",(P=C("PageGame"),b=S(p),y=S(l),B=S(u),T=S(v),P((R=n((E=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return n=e.call.apply(e,[this].concat(o))||this,i(n,"levelLbl",R,a(n)),i(n,"map",L,a(n)),i(n,"mapModal",G,a(n)),i(n,"propBtns",M,a(n)),n.relifeTimes=1,n.timer=0,n.tweens=new Set,n}t(n,e);var r=n.prototype;return r.onLoad=function(){this.map.event.on(f.TimeOver,this.gameOver,this),this.map.event.on(f.FullItem,this.gameOver,this),this.map.event.on(f.GameFinish,this.gameFinish,this),this.map.event.on(f.PropLack,this.OnLackProp,this),this.map.event.on(f.EnterTween,this.onEnterTween,this),this.map.event.on(f.ExitTween,this.onExitTween,this),this.map.event.on(f.GameStart,this.onGameStart,this),this.map.event.on(f.GameReady,this.onGameReady,this);for(var e=0;e<this.propBtns.length;e++){var n=this.propBtns[e];n.event.on(g.ClickUse,this.onClickUse,this),n.event.on(g.ClickLack,this.onClickLack,this),n.request.on(w.RequestUse,this.onRequestUse,this),n.request.on(w.RequestLack,this.onRequestLack,this),n.refresh()}this.map.event.on(f.SecondTick,this.onSecondTick,this),c.manager.event.on(h.RefreshProp,this.refreshProp,this),this.mapModal.active=!0},r.onGameReady=function(){this.propBtns.forEach((function(e){return e.ban=!0}))},r.onGameStart=function(){this.propBtns.forEach((function(e){return e.ban=!1})),this.mapModal.active=!1,this.tweens.clear()},r.onEnterTween=function(e){this.tweens.add(e),this.refreshBtnBans()},r.onExitTween=function(e){this.tweens.delete(e),this.refreshBtnBans()},r.refreshBtnBans=function(){this.tweens.size>0?this.propBtns[2].ban=!0:this.propBtns[2].ban=!1},r.onRequestLack=function(e){return!0},r.onRequestUse=function(e){var n=this,t=[{cond:function(){return null!=n.map.findItemsCanElimiate()},msg:"请移出下层麻将"},{cond:function(){return null!=n.map.findItemsCanElimiate()},msg:"请移出下层麻将"},{cond:function(){return!(n.map.mapGenCls instanceof d)},msg:"此关卡无法使用刷新"}][e];return!!t.cond()||(c.manager.ui.showToast(t.msg),!1)},r.refreshProp=function(){this.propBtns.forEach((function(e){return e.refresh()}))},r.onClickUse=function(e){var n,t=[this.map.propTips.bind(this.map),this.map.propElimiate.bind(this.map),this.map.propRefresh.bind(this.map)];null==(n=t[e.propId])||n.call(t),c.data.storage.propNum[e.propId]--,c.manager.event.emit(h.RefreshProp)},r.onClickLack=function(e){this.OnLackProp(e.propId)},r.onSecondTick=function(){this.timer++},r.onShow=function(){c.manager.sound.playMusic({name:"music/homeBGM"}),this.relifeTimes=1,this.map.load(),this.levelLbl.string="第 "+c.data.storage.level.toFixed()+" 关",this.timer=0},r.OnLackProp=function(e){var n=this;c.manager.ui.show({name:"PopAddProp",data:e,onHide:function(e){n.map.gameResume()},onShow:function(e){n.map.gamePause()}})},r.onHide=function(){this.map.event.offAll(),this.map.exit()},r.gameOver=function(){var e=o((function*(){var e=this,n=function(){var n=o((function*(){e.map.gameExit(),e.mapModal.active=!0,yield Promise.all(e.tweens),e.tweens.clear(),c.manager.ui.show({name:"PopGameOver"})}));return function(){return n.apply(this,arguments)}}();this.relifeTimes>=1?(this.relifeTimes--,e.map.gamePause(),c.manager.ui.show({name:"PopRelife",data:{confirmFunc:function(){e.map.remainTime=Math.max(e.map.remainTime,c.config.game.gameTime/2),e.onRequestUse(2)&&e.map.propRefresh(),e.map.gameResume()},cancelFunc:function(){n()}}})):n()}));return function(){return e.apply(this,arguments)}}(),r.gameFinish=function(){var e=o((function*(){this.map.gameExit(),this.mapModal.active=!0,yield Promise.all(this.tweens),this.tweens.clear(),c.manager.ui.show({name:"PopGameFinish",data:this.timer})}));return function(){return e.apply(this,arguments)}}(),r.openSetting=function(){c.manager.ui.show({name:"PopSettingPanel",data:1})},n}(m)).prototype,"levelLbl",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=n(E.prototype,"map",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=n(E.prototype,"mapModal",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(E.prototype,"propBtns",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),k=E))||k));r._RF.pop()}}}));

System.register("chunks:///_virtual/PropBtn.ts",["./rollupPluginModLoBabelHelpers.js","cc","./app.ts","./Utils2.ts"],(function(t){var e,n,i,r,o,s,a,u,c,l,p,h,f,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized,o=t.createClass},function(t){s=t.cclegacy,a=t._decorator,u=t.Label,c=t.Node,l=t.Button,p=t.Sprite,h=t.Component},function(t){f=t.app},function(t){d=t.and}],execute:function(){var b,g,m,v,y,L,k,C;s._RF.push({},"a9bceLYfDFP8ZivWlxnCma2","PropBtn",void 0);var q=a.ccclass,P=a.property,B=t("EPropBtnEvent",{ClickUse:0,ClickLack:1}),F=t("EPropBtnRequest",{RequestUse:0,RequestLack:1});t("PropBtn",(b=q("PropBtn"),g=P(u),m=P(c),b((L=e((y=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this)._ban=!1,i(e,"propId",L,r(e)),i(e,"numLbl",k,r(e)),i(e,"addFlag",C,r(e)),e.event=f.gp.obs(),e.request=f.gp.obs(),e}n(e,t);var s=e.prototype;return s.onLoad=function(){this.node.on(l.EventType.CLICK,this.onClick,this)},s.refresh=function(){this.numLbl.string=this.num.toString(),this.num<=0?(this.addFlag.active=!0,this.numLbl.node.active=!1):(this.addFlag.active=!1,this.numLbl.node.active=!0)},s.onClick=function(){if(!this.ban)if(f.data.debug.infinityProp)this.event.emit(B.ClickUse,this);else if(this.num>0){var t=this.request.req(F.RequestUse,this.propId);d(t)&&this.event.emit(B.ClickUse,this)}else{var e=this.request.req(F.RequestLack,this.propId);d(e)&&this.event.emit(B.ClickLack,this)}},o(e,[{key:"ban",get:function(){return this._ban},set:function(t){this._ban=t,this.getComponent(p).grayscale=t}},{key:"num",get:function(){return f.data.storage.propNum[this.propId]}}]),e}(h)).prototype,"propId",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),k=e(y.prototype,"numLbl",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(y.prototype,"addFlag",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=y))||v));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/page-game', 'chunks:///_virtual/page-game'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});